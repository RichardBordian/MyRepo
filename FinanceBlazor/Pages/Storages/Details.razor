@page "/details/{id}"

<PageTitle>Details</PageTitle>
<MudText Typo="Typo.h3" Class="ml-3">Name: @storageInfo?.Name</MudText>
<MudText Typo="Typo.h4" Class="ml-3">Value: @storageInfo?.Value</MudText>
<MudText Typo="Typo.h5" Class="ml-3">Transactions list</MudText>

<MudTable
    T="TransactionByStorageDTO"
    items ="@transactions"
    Hover="true"
    Breakpoint="Breakpoint.Sm"
    RowClass="cursor-pointer"
    LoadingProgressColor="Color.Info"
    OnRowClick="RowClickEvent">

    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Price</MudTh>
        <MudTh>Date</MudTh>
        <MudTh>CategoryId</MudTh>
        <MudTh>Description</MudTh>
    </HeaderContent>

    <RowTemplate>
        <MudLink Href="@href" Underline="Underline.Always">
            <MudTd DataLabel="Name">@context.Name</MudTd>
        </MudLink>
        <MudTd DataLabel="Price">@context.Price</MudTd>
        <MudTd DataLabel="Date">@context.Date.ToShortDateString()</MudTd>
        <MudTd DataLabel="CategoryId">@context.CategoryId</MudTd>
        <MudTd DataLabel="Description">@context.Description</MudTd>
    </RowTemplate>
</MudTable>

@code
{
    [Parameter]
    public string id { get; set; } = "";
    StorageViewDTO? storageInfo;
    static HttpClient httpClient = new HttpClient();
    List<TransactionByStorageDTO>? transactions = new List<TransactionByStorageDTO>();
    string? href;

    protected override async Task OnInitializedAsync()
    {
        storageInfo = await httpClient.GetFromJsonAsync<StorageViewDTO>($"http://localhost:5220/api/Storage/{id}");
        transactions = await httpClient.GetFromJsonAsync<List<TransactionByStorageDTO>>($"http://localhost:5220/api/Transaction/storageid/{id}");
    }

    private void RowClickEvent(TableRowClickEventArgs<TransactionByStorageDTO> tableRowClickEventArgs)
    {
        href = "/transaction/details/" + tableRowClickEventArgs.Item.Id;
    }
}